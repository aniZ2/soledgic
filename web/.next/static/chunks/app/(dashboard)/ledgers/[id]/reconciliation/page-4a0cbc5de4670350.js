(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1164],{7285:function(e,t,n){Promise.resolve().then(n.bind(n,5343))},9205:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(2265);let a=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),s=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter((e,t,n)=>!!e&&""!==e.trim()&&n.indexOf(e)===t).join(" ").trim()};var c={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let d=(0,r.forwardRef)((e,t)=>{let{color:n="currentColor",size:a=24,strokeWidth:d=2,absoluteStrokeWidth:i,className:o="",children:l,iconNode:m,...u}=e;return(0,r.createElement)("svg",{ref:t,...c,width:a,height:a,stroke:n,strokeWidth:i?24*Number(d)/Number(a):d,className:s("lucide",o),...u},[...m.map(e=>{let[t,n]=e;return(0,r.createElement)(t,n)}),...Array.isArray(l)?l:[l]])}),i=(e,t)=>{let n=(0,r.forwardRef)((n,c)=>{let{className:i,...o}=n;return(0,r.createElement)(d,{ref:c,iconNode:t,className:s("lucide-".concat(a(e)),i),...o})});return n.displayName="".concat(e),n}},2660:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(9205).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},2934:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(9205).Z)("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]])},9985:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(9205).Z)("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]])},9397:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(9205).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},7689:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(9205).Z)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]])},7648:function(e,t,n){"use strict";n.d(t,{default:function(){return a.a}});var r=n(2972),a=n.n(r)},5343:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return m}});var r=n(7437),a=n(2265),s=n(7648),c=n(2660),d=n(7689),i=n(9397),o=n(9985),l=n(2934);function m(e){let{params:t}=e,{id:n}=(0,a.use)(t),[m,u]=(0,a.useState)([]),[x,h]=(0,a.useState)(""),[f,g]=(0,a.useState)([]),[p,b]=(0,a.useState)([]),[j,y]=(0,a.useState)(!0),[N,v]=(0,a.useState)(null),[k,w]=(0,a.useState)(null);(0,a.useEffect)(()=>{(async function(){var e;let t=await fetch("/api/ledgers/".concat(n,"/bank-accounts")),r=await t.json();u(r.bank_accounts||[]),(null===(e=r.bank_accounts)||void 0===e?void 0:e.length)>0&&h(r.bank_accounts[0].id),y(!1)})()},[n]),(0,a.useEffect)(()=>{x&&e();async function e(){let[e,t]=await Promise.all([fetch("/api/ledgers/".concat(n,"/bank-lines?account_id=").concat(x,"&status=unmatched")),fetch("/api/ledgers/".concat(n,"/transactions?unreconciled=true"))]),r=await e.json(),a=await t.json();g(r.lines||[]),b(a.transactions||[])}},[n,x]);let _=async()=>{if(N&&k)try{await fetch("/api/ledgers/".concat(n,"/reconcile"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"match",bank_line_id:N,transaction_id:k})}),g(e=>e.filter(e=>e.id!==N)),b(e=>e.filter(e=>e.id!==k)),v(null),w(null)}catch(e){console.error("Match failed:",e)}},Z=async()=>{try{let e=await fetch("/api/ledgers/".concat(n,"/reconcile"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"auto_match",bank_account_id:x})});await e.json(),window.location.reload()}catch(e){console.error("Auto-match failed:",e)}};return(0,r.jsxs)("div",{children:[(0,r.jsxs)(s.default,{href:"/ledgers/".concat(n),className:"inline-flex items-center gap-2 text-muted-foreground hover:text-foreground mb-6",children:[(0,r.jsx)(c.Z,{className:"h-4 w-4"}),"Back to ledger"]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-foreground",children:"Bank Reconciliation"}),(0,r.jsx)("p",{className:"mt-1 text-muted-foreground",children:"Match bank transactions with your ledger entries"})]}),(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsxs)(s.default,{href:"/ledgers/".concat(n,"/reconciliation/import"),className:"flex items-center gap-2 px-4 py-2 border border-border rounded-md hover:bg-accent",children:[(0,r.jsx)(d.Z,{className:"h-4 w-4"}),"Import statement"]}),(0,r.jsxs)(s.default,{href:"/ledgers/".concat(n,"/reconciliation/accounts"),className:"flex items-center gap-2 px-4 py-2 border border-border rounded-md hover:bg-accent",children:[(0,r.jsx)(i.Z,{className:"h-4 w-4"}),"Add bank account"]})]})]}),m.length>0&&(0,r.jsxs)("div",{className:"mt-6",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Bank Account"}),(0,r.jsx)("select",{value:x,onChange:e=>h(e.target.value),className:"px-4 py-2 border border-border rounded-md bg-background text-foreground",children:m.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.bank_name," - ",e.account_name," (****",e.account_last_four,")"]},e.id))})]}),j?(0,r.jsx)("div",{className:"mt-8 text-center text-muted-foreground",children:"Loading..."}):0===m.length?(0,r.jsxs)("div",{className:"mt-8 bg-card border border-border rounded-lg p-12 text-center",children:[(0,r.jsx)(d.Z,{className:"h-12 w-12 text-muted-foreground mx-auto"}),(0,r.jsx)("h3",{className:"mt-4 text-lg font-medium text-foreground",children:"No bank accounts"}),(0,r.jsx)("p",{className:"mt-2 text-muted-foreground max-w-sm mx-auto",children:"Add a bank account and import statements to start reconciling."}),(0,r.jsxs)(s.default,{href:"/ledgers/".concat(n,"/reconciliation/accounts"),className:"mt-6 inline-flex items-center gap-2 bg-primary text-primary-foreground px-4 py-2 rounded-md hover:bg-primary/90",children:[(0,r.jsx)(i.Z,{className:"h-4 w-4"}),"Add bank account"]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"mt-6 flex items-center justify-between p-4 bg-muted/50 rounded-lg",children:[(0,r.jsx)("div",{className:"flex items-center gap-4",children:(0,r.jsxs)("span",{className:"text-sm text-muted-foreground",children:[f.length," unmatched bank lines â€¢ ",p.length," unmatched transactions"]})}),(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsx)("button",{onClick:Z,className:"px-4 py-2 border border-border rounded-md hover:bg-accent text-sm",children:"Auto-match"}),(0,r.jsxs)("button",{onClick:_,disabled:!N||!k,className:"flex items-center gap-2 bg-primary text-primary-foreground px-4 py-2 rounded-md hover:bg-primary/90 disabled:opacity-50 text-sm",children:[(0,r.jsx)(o.Z,{className:"h-4 w-4"}),"Match selected"]})]})]}),(0,r.jsxs)("div",{className:"mt-6 grid grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-foreground mb-4",children:"Bank Statement Lines"}),(0,r.jsx)("div",{className:"bg-card border border-border rounded-lg overflow-hidden",children:f.length>0?(0,r.jsx)("div",{className:"divide-y divide-border",children:f.map(e=>(0,r.jsxs)("div",{onClick:()=>v(e.id===N?null:e.id),className:"p-4 cursor-pointer hover:bg-muted/50 ".concat(N===e.id?"bg-primary/10 border-l-4 border-l-primary":""),children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-sm text-muted-foreground",children:new Date(e.date).toLocaleDateString()}),(0,r.jsxs)("span",{className:"font-medium ".concat("credit"===e.type?"text-green-500":"text-red-500"),children:["credit"===e.type?"+":"-","$",(e.amount/100).toFixed(2)]})]}),(0,r.jsx)("p",{className:"mt-1 text-foreground text-sm truncate",children:e.description})]},e.id))}):(0,r.jsxs)("div",{className:"p-8 text-center text-muted-foreground",children:[(0,r.jsx)(l.Z,{className:"h-8 w-8 mx-auto mb-2 text-green-500"}),"All bank lines matched"]})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-foreground mb-4",children:"Ledger Transactions"}),(0,r.jsx)("div",{className:"bg-card border border-border rounded-lg overflow-hidden",children:p.length>0?(0,r.jsx)("div",{className:"divide-y divide-border",children:p.map(e=>(0,r.jsxs)("div",{onClick:()=>w(e.id===k?null:e.id),className:"p-4 cursor-pointer hover:bg-muted/50 ".concat(k===e.id?"bg-primary/10 border-l-4 border-l-primary":""),children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-sm text-muted-foreground",children:new Date(e.created_at).toLocaleDateString()}),(0,r.jsxs)("span",{className:"font-medium text-foreground",children:["$",(e.amount/100).toFixed(2)]})]}),(0,r.jsxs)("div",{className:"mt-1 flex items-center gap-2",children:[(0,r.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ".concat("sale"===e.transaction_type?"bg-green-500/10 text-green-500":"expense"===e.transaction_type?"bg-red-500/10 text-red-500":"bg-muted text-muted-foreground"),children:e.transaction_type}),(0,r.jsx)("span",{className:"text-sm text-foreground truncate",children:e.description})]})]},e.id))}):(0,r.jsxs)("div",{className:"p-8 text-center text-muted-foreground",children:[(0,r.jsx)(l.Z,{className:"h-8 w-8 mx-auto mb-2 text-green-500"}),"All transactions matched"]})})]})]}),N&&k&&(0,r.jsx)("div",{className:"mt-6 p-4 bg-green-500/10 border border-green-500/20 rounded-lg",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(o.Z,{className:"h-5 w-5 text-green-500"}),(0,r.jsx)("span",{className:"font-medium text-foreground",children:"Ready to match"})]}),(0,r.jsx)("button",{onClick:()=>{v(null),w(null)},className:"text-sm text-muted-foreground hover:text-foreground",children:"Clear selection"})]})})]})]})}}},function(e){e.O(0,[2972,2971,2117,1744],function(){return e(e.s=7285)}),_N_E=e.O()}]);