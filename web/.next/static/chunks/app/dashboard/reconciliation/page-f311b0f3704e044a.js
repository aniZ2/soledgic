(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3766],{6847:function(e,t,s){Promise.resolve().then(s.bind(s,4793))},9205:function(e,t,s){"use strict";s.d(t,{Z:function(){return d}});var a=s(2265);let n=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),i=function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return t.filter((e,t,s)=>!!e&&""!==e.trim()&&s.indexOf(e)===t).join(" ").trim()};var c={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let r=(0,a.forwardRef)((e,t)=>{let{color:s="currentColor",size:n=24,strokeWidth:r=2,absoluteStrokeWidth:d,className:l="",children:o,iconNode:m,...h}=e;return(0,a.createElement)("svg",{ref:t,...c,width:n,height:n,stroke:s,strokeWidth:d?24*Number(r)/Number(n):r,className:i("lucide",l),...h},[...m.map(e=>{let[t,s]=e;return(0,a.createElement)(t,s)}),...Array.isArray(o)?o:[o]])}),d=(e,t)=>{let s=(0,a.forwardRef)((s,c)=>{let{className:d,...l}=s;return(0,a.createElement)(r,{ref:c,iconNode:t,className:i("lucide-".concat(n(e)),d),...l})});return s.displayName="".concat(e),s}},8420:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9205).Z)("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]])},401:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9205).Z)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},2934:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9205).Z)("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]])},9985:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9205).Z)("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]])},1817:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9205).Z)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},7168:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9205).Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},3247:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9205).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},7689:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9205).Z)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]])},4793:function(e,t,s){"use strict";s.d(t,{BankReconciliationPage:function(){return b}});var a=s(7437),n=s(2265),i=s(1817),c=s(9205);let r=(0,c.Z)("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);var d=s(7689),l=s(2934);let o=(0,c.Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);var m=s(8420);let h=(0,c.Z)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);var x=s(9985),u=s(401),p=s(7168),f=s(3247);function b(){let[e,t]=(0,n.useState)([]),[s,c]=(0,n.useState)([]),[b,j]=(0,n.useState)(!0),[v,y]=(0,n.useState)(null),[N,g]=(0,n.useState)(null),[w,k]=(0,n.useState)(null),[C,S]=(0,n.useState)(""),[Z,M]=(0,n.useState)(""),[R,_]=(0,n.useState)(!1),[A,L]=(0,n.useState)(!1),[T,E]=(0,n.useState)({matched:0,unmatched:0,matchedAmount:0,unmatchedAmount:0}),P=async()=>{j(!0);try{let e=await fetch("/api/reconcile",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"list_unmatched"})}),s=await e.json();if(s.success){let e=(s.transactions||[]).map(e=>{var t,s;return{id:e.id,referenceId:e.reference_id,description:e.description,amount:e.amount,date:e.created_at,status:e.status,isReconciled:(null===(t=e.metadata)||void 0===t?void 0:t.reconciled)||!1,bankMatchId:null===(s=e.metadata)||void 0===s?void 0:s.bank_match_id}});t(e);let a=e.filter(e=>e.isReconciled),n=e.filter(e=>!e.isReconciled);E({matched:a.length,unmatched:n.length,matchedAmount:a.reduce((e,t)=>e+t.amount,0),unmatchedAmount:n.reduce((e,t)=>e+t.amount,0)})}}catch(e){console.error("Failed to fetch:",e)}j(!1)};(0,n.useEffect)(()=>{P()},[]),(0,n.useEffect)(()=>{c([{id:"bank_1",description:"STRIPE TRANSFER",amount:1250,date:"2024-12-18",matched:!1},{id:"bank_2",description:"PAYPAL PAYMENT",amount:89.99,date:"2024-12-17",matched:!1},{id:"bank_3",description:"STRIPE TRANSFER",amount:450,date:"2024-12-16",matched:!1},{id:"bank_4",description:"CHECK DEP #1234",amount:2e3,date:"2024-12-15",matched:!1},{id:"bank_5",description:"STRIPE PAYOUT",amount:875.5,date:"2024-12-14",matched:!1}])},[]);let I=async()=>{if(N&&w){y(N);try{let e=await fetch("/api/reconcile",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"match",transaction_id:N,bank_transaction_id:w})}),s=await e.json();s.success?(t(e=>e.map(e=>e.id===N?{...e,isReconciled:!0,bankMatchId:s.match_id}:e)),c(e=>e.map(e=>e.id===w?{...e,matched:!0,matchedToId:N}:e)),g(null),k(null),E(e=>({...e,matched:e.matched+1,unmatched:e.unmatched-1}))):alert(s.error||"Failed to match")}catch(e){alert("Failed to match transactions")}y(null)}},O=async e=>{try{let s=await fetch("/api/reconcile",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"unmatch",transaction_id:e})});(await s.json()).success&&(t(t=>t.map(t=>t.id===e?{...t,isReconciled:!1,bankMatchId:void 0}:t)),P())}catch(e){alert("Failed to unmatch")}},q=async()=>{L(!0);let t=e.filter(e=>!e.isReconciled),a=s.filter(e=>!e.matched),n=0;for(let e of t){let t=a.find(t=>.01>Math.abs(t.amount-e.amount)&&!t.matched);if(t)try{let s=await fetch("/api/reconcile",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"match",transaction_id:e.id,bank_transaction_id:t.id})});(await s.json()).success&&(n++,t.matched=!0)}catch(e){}}L(!1),P(),alert("Auto-matched ".concat(n," transactions"))},B=e.filter(e=>R||!e.isReconciled).filter(e=>{var t,s;return(null===(t=e.description)||void 0===t?void 0:t.toLowerCase().includes(C.toLowerCase()))||(null===(s=e.referenceId)||void 0===s?void 0:s.toLowerCase().includes(C.toLowerCase()))}),U=s.filter(e=>R||!e.matched).filter(e=>e.description.toLowerCase().includes(Z.toLowerCase())),F=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e),H=e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric"});return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold text-[#1C1917]",children:"Bank Reconciliation"}),(0,a.jsx)("p",{className:"text-[14px] text-stone-500 mt-1",children:"Match ledger entries with bank transactions"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("button",{onClick:q,disabled:A,className:"flex items-center gap-2 px-4 py-2 bg-violet-600 text-white rounded-lg text-[13px] font-medium hover:bg-violet-700 disabled:opacity-50",children:[A?(0,a.jsx)(i.Z,{className:"w-4 h-4 animate-spin"}):(0,a.jsx)(r,{className:"w-4 h-4"}),"Auto-Match"]}),(0,a.jsxs)("button",{className:"flex items-center gap-2 px-4 py-2 bg-white border border-stone-200 rounded-lg text-[13px] font-medium hover:bg-stone-50",children:[(0,a.jsx)(d.Z,{className:"w-4 h-4"}),"Import Bank Statement"]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,a.jsx)("div",{className:"bg-white rounded-xl border border-stone-200 p-5",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-lg bg-emerald-50 flex items-center justify-center",children:(0,a.jsx)(l.Z,{className:"w-5 h-5 text-emerald-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-[12px] text-stone-500 font-medium",children:"Reconciled"}),(0,a.jsx)("div",{className:"text-xl font-semibold text-[#1C1917]",children:T.matched})]})]})}),(0,a.jsx)("div",{className:"bg-white rounded-xl border border-stone-200 p-5",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-lg bg-amber-50 flex items-center justify-center",children:(0,a.jsx)(o,{className:"w-5 h-5 text-amber-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-[12px] text-stone-500 font-medium",children:"Unreconciled"}),(0,a.jsx)("div",{className:"text-xl font-semibold text-[#1C1917]",children:T.unmatched})]})]})}),(0,a.jsx)("div",{className:"bg-white rounded-xl border border-stone-200 p-5",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-lg bg-blue-50 flex items-center justify-center",children:(0,a.jsx)(m.Z,{className:"w-5 h-5 text-blue-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-[12px] text-stone-500 font-medium",children:"Bank Balance"}),(0,a.jsx)("div",{className:"text-xl font-semibold text-[#1C1917]",children:"$24,532.00"})]})]})}),(0,a.jsx)("div",{className:"bg-white rounded-xl border border-stone-200 p-5",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-lg bg-violet-50 flex items-center justify-center",children:(0,a.jsx)(h,{className:"w-5 h-5 text-violet-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-[12px] text-stone-500 font-medium",children:"Difference"}),(0,a.jsx)("div",{className:"text-xl font-semibold text-red-600",children:"-$127.50"})]})]})})]}),N&&w&&(0,a.jsxs)("div",{className:"bg-emerald-50 border border-emerald-200 rounded-xl p-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(x.Z,{className:"w-5 h-5 text-emerald-600"}),(0,a.jsx)("span",{className:"text-[14px] text-emerald-800",children:"Ready to match selected transactions"})]}),(0,a.jsxs)("button",{onClick:I,disabled:!!v,className:"flex items-center gap-2 px-4 py-2 bg-emerald-600 text-white rounded-lg text-[13px] font-medium hover:bg-emerald-700 disabled:opacity-50",children:[v?(0,a.jsx)(i.Z,{className:"w-4 h-4 animate-spin"}):(0,a.jsx)(u.Z,{className:"w-4 h-4"}),"Confirm Match"]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-xl border border-stone-200 overflow-hidden",children:[(0,a.jsxs)("div",{className:"px-5 py-4 border-b border-stone-100 flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"font-semibold text-[#1C1917]",children:"Ledger Transactions"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("label",{className:"flex items-center gap-2 text-[12px] text-stone-500",children:[(0,a.jsx)("input",{type:"checkbox",checked:R,onChange:e=>_(e.target.checked),className:"rounded"}),"Show matched"]}),(0,a.jsx)("button",{onClick:P,className:"p-1.5 hover:bg-stone-100 rounded",children:(0,a.jsx)(p.Z,{className:"w-4 h-4 text-stone-400 ".concat(b?"animate-spin":"")})})]})]}),(0,a.jsx)("div",{className:"px-4 py-3 border-b border-stone-100",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(f.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-stone-400"}),(0,a.jsx)("input",{type:"text",placeholder:"Search transactions...",value:C,onChange:e=>S(e.target.value),className:"w-full pl-10 pr-4 py-2 bg-stone-50 border border-stone-200 rounded-lg text-[13px] placeholder:text-stone-400 focus:outline-none focus:ring-2 focus:ring-stone-200"})]})}),(0,a.jsx)("div",{className:"max-h-[500px] overflow-y-auto",children:0===B.length?(0,a.jsx)("div",{className:"p-8 text-center text-stone-500 text-[14px]",children:b?"Loading...":"No transactions to reconcile"}):B.map(e=>(0,a.jsx)("div",{onClick:()=>!e.isReconciled&&g(N===e.id?null:e.id),className:"px-5 py-3 border-b border-stone-50 cursor-pointer transition-colors ".concat(e.isReconciled?"bg-emerald-50/50 opacity-60":N===e.id?"bg-blue-50 border-l-2 border-l-blue-500":"hover:bg-stone-50"),children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[e.isReconciled?(0,a.jsx)("div",{className:"w-6 h-6 rounded-full bg-emerald-100 flex items-center justify-center",children:(0,a.jsx)(u.Z,{className:"w-3.5 h-3.5 text-emerald-600"})}):(0,a.jsx)("div",{className:"w-6 h-6 rounded-full border-2 flex items-center justify-center ".concat(N===e.id?"border-blue-500 bg-blue-500":"border-stone-300"),children:N===e.id&&(0,a.jsx)(u.Z,{className:"w-3.5 h-3.5 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-[13px] font-medium text-[#1C1917]",children:e.description||e.referenceId}),(0,a.jsx)("p",{className:"text-[12px] text-stone-500",children:H(e.date)})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"text-[14px] font-medium text-[#1C1917]",children:F(e.amount)}),e.isReconciled&&(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),O(e.id)},className:"text-[11px] text-red-600 hover:underline",children:"Unmatch"})]})]})},e.id))})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl border border-stone-200 overflow-hidden",children:[(0,a.jsxs)("div",{className:"px-5 py-4 border-b border-stone-100 flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"font-semibold text-[#1C1917]",children:"Bank Statement"}),(0,a.jsx)("span",{className:"text-[12px] text-stone-500",children:"Chase •••• 4521"})]}),(0,a.jsx)("div",{className:"px-4 py-3 border-b border-stone-100",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(f.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-stone-400"}),(0,a.jsx)("input",{type:"text",placeholder:"Search bank transactions...",value:Z,onChange:e=>M(e.target.value),className:"w-full pl-10 pr-4 py-2 bg-stone-50 border border-stone-200 rounded-lg text-[13px] placeholder:text-stone-400 focus:outline-none focus:ring-2 focus:ring-stone-200"})]})}),(0,a.jsx)("div",{className:"max-h-[500px] overflow-y-auto",children:U.map(e=>(0,a.jsx)("div",{onClick:()=>!e.matched&&k(w===e.id?null:e.id),className:"px-5 py-3 border-b border-stone-50 cursor-pointer transition-colors ".concat(e.matched?"bg-emerald-50/50 opacity-60":w===e.id?"bg-blue-50 border-l-2 border-l-blue-500":"hover:bg-stone-50"),children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[e.matched?(0,a.jsx)("div",{className:"w-6 h-6 rounded-full bg-emerald-100 flex items-center justify-center",children:(0,a.jsx)(u.Z,{className:"w-3.5 h-3.5 text-emerald-600"})}):(0,a.jsx)("div",{className:"w-6 h-6 rounded-full border-2 flex items-center justify-center ".concat(w===e.id?"border-blue-500 bg-blue-500":"border-stone-300"),children:w===e.id&&(0,a.jsx)(u.Z,{className:"w-3.5 h-3.5 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-[13px] font-medium text-[#1C1917]",children:e.description}),(0,a.jsx)("p",{className:"text-[12px] text-stone-500",children:H(e.date)})]})]}),(0,a.jsx)("p",{className:"text-[14px] font-medium text-[#1C1917]",children:F(e.amount)})]})},e.id))})]})]}),(0,a.jsxs)("div",{className:"bg-stone-50 rounded-xl p-4 flex items-start gap-3",children:[(0,a.jsx)(h,{className:"w-5 h-5 text-stone-400 flex-shrink-0 mt-0.5"}),(0,a.jsxs)("div",{className:"text-[13px] text-stone-600",children:[(0,a.jsx)("p",{className:"font-medium text-stone-700 mb-1",children:"How to reconcile"}),(0,a.jsx)("p",{children:'Select one transaction from each column, then click "Confirm Match" to link them. Matched transactions will be marked as reconciled and cannot be modified in locked periods. Use "Auto-Match" to automatically match transactions with identical amounts.'})]})]})]})}}},function(e){e.O(0,[2971,2117,1744],function(){return e(e.s=6847)}),_N_E=e.O()}]);