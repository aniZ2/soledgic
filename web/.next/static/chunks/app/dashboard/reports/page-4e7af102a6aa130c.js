(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7001],{734:function(e,t,s){Promise.resolve().then(s.bind(s,8514))},8514:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return _}});var a=s(7437),n=s(2265),l=s(525),i=s(4502),r=s(5805),d=s(8736),c=s(1047),o=s(6337),x=s(407),m=s(1817),p=s(2735),h=s(9864),u=s(3235),j=s(2489),b=s(401),f=s(6865),N=s(8906),v=s(2934),g=s(2208),y=s(2451);function w(e){var t,s;let{open:l,onClose:r,onComplete:d,defaultYear:h,defaultMonth:u}=e,[w,C]=(0,n.useState)(1),[_,k]=(0,n.useState)(h||new Date().getFullYear()),[T,S]=(0,n.useState)(u||new Date().getMonth()),[P,F]=(0,n.useState)(!1),[Z,D]=(0,n.useState)(!1),[R,O]=(0,n.useState)([]),[L,$]=(0,n.useState)([]),[A,E]=(0,n.useState)({debits:0,credits:0,balanced:!1}),[q,B]=(0,n.useState)(null),[U,Y]=(0,n.useState)(""),I=["January","February","March","April","May","June","July","August","September","October","November","December"],M=new Date().getFullYear(),J=Array.from({length:5},(e,t)=>M-t);(0,n.useEffect)(()=>{l&&(C(1),B(null),Y(""))},[l]),(0,n.useEffect)(()=>{2===w&&z()},[w]),(0,n.useEffect)(()=>{3===w&&V()},[w]);let z=async()=>{O([{id:"balance",name:"Ledger Balance",description:"Verify debits equal credits",status:"checking",required:!0},{id:"reconciled",name:"Bank Reconciliation",description:"All transactions reconciled",status:"pending",required:!1},{id:"unposted",name:"Unposted Entries",description:"No draft transactions",status:"pending",required:!1},{id:"prior",name:"Prior Period",description:"Previous month is closed",status:"pending",required:!1}]),await new Promise(e=>setTimeout(e,500));try{var e,t,s;let a=await fetch("/api/reports",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({report_type:"trial_balance"})}),n=await a.json(),l=null!==(s=null===(t=n.report)||void 0===t?void 0:null===(e=t.totals)||void 0===e?void 0:e.balanced)&&void 0!==s&&s;O(e=>e.map(e=>{var t,s,a,i;return"balance"===e.id?{...e,status:l?"passed":"failed",details:l?"Ledger is balanced":"Difference: $".concat(Math.abs((null===(s=n.report)||void 0===s?void 0:null===(t=s.totals)||void 0===t?void 0:t.debits)-(null===(i=n.report)||void 0===i?void 0:null===(a=i.totals)||void 0===a?void 0:a.credits)).toFixed(2))}:e}))}catch(e){O(e=>e.map(e=>"balance"===e.id?{...e,status:"failed",details:"Could not verify"}:e))}await new Promise(e=>setTimeout(e,300)),O(e=>e.map(e=>"reconciled"===e.id?{...e,status:"checking"}:e)),await new Promise(e=>setTimeout(e,400)),O(e=>e.map(e=>"reconciled"===e.id?{...e,status:"warning",details:"3 transactions unreconciled"}:e)),await new Promise(e=>setTimeout(e,300)),O(e=>e.map(e=>"unposted"===e.id?{...e,status:"checking"}:e)),await new Promise(e=>setTimeout(e,300)),O(e=>e.map(e=>"unposted"===e.id?{...e,status:"passed",details:"No draft entries"}:e)),await new Promise(e=>setTimeout(e,300)),O(e=>e.map(e=>"prior"===e.id?{...e,status:"checking"}:e)),await new Promise(e=>setTimeout(e,300)),O(e=>e.map(e=>"prior"===e.id?{...e,status:"passed",details:"".concat(I[T-1]||I[11]," ").concat(0===T?_-1:_," is closed")}:e))},V=async()=>{F(!0);try{let a=await fetch("/api/reports",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({report_type:"trial_balance"})}),n=await a.json();if(n.success&&n.report){var e,t,s;$(n.report.accounts||[]),E({debits:(null===(e=n.report.totals)||void 0===e?void 0:e.debits)||0,credits:(null===(t=n.report.totals)||void 0===t?void 0:t.credits)||0,balanced:(null===(s=n.report.totals)||void 0===s?void 0:s.balanced)||!1})}}catch(e){console.error("Failed to fetch trial balance:",e)}F(!1)},W=async()=>{D(!0);try{let e=await fetch("/api/periods",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"close",year:_,month:T+1,notes:U})}),t=await e.json();t.success?(B(t),C(5)):alert(t.error||"Failed to close period")}catch(e){alert("Failed to close period")}D(!1)},G=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e),H=R.filter(e=>e.required).every(e=>"passed"===e.status);return l?(0,a.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-black/50",onClick:r}),(0,a.jsxs)("div",{className:"relative bg-white rounded-2xl shadow-xl w-full max-w-2xl mx-4 max-h-[90vh] overflow-hidden flex flex-col",children:[(0,a.jsxs)("div",{className:"px-6 py-4 border-b flex items-center justify-between bg-gradient-to-r from-stone-900 to-stone-800",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-xl bg-white/10 flex items-center justify-center",children:(0,a.jsx)(o.Z,{className:"w-5 h-5 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"font-semibold text-lg text-white",children:"Close Month"}),(0,a.jsxs)("p",{className:"text-[13px] text-stone-300",children:["Lock ",I[T]," ",_," for editing"]})]})]}),(0,a.jsx)("button",{onClick:r,className:"p-2 hover:bg-white/10 rounded-lg transition-colors",children:(0,a.jsx)(j.Z,{className:"w-5 h-5 text-white"})})]}),(0,a.jsx)("div",{className:"px-6 py-4 border-b bg-stone-50",children:(0,a.jsx)("div",{className:"flex items-center justify-between",children:[{num:1,label:"Select Period"},{num:2,label:"Preflight Checks"},{num:3,label:"Review Balance"},{num:4,label:"Confirm Close"},{num:5,label:"Complete"}].map((e,t)=>(0,a.jsxs)(n.Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-col items-center",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-[13px] font-medium transition-colors ".concat(w>e.num?"bg-emerald-500 text-white":w===e.num?"bg-stone-900 text-white":"bg-stone-200 text-stone-500"),children:w>e.num?(0,a.jsx)(b.Z,{className:"w-4 h-4"}):e.num}),(0,a.jsx)("span",{className:"text-[11px] mt-1 ".concat(w>=e.num?"text-stone-700":"text-stone-400"),children:e.label})]}),t<4&&(0,a.jsx)("div",{className:"flex-1 h-0.5 mx-2 ".concat(w>e.num?"bg-emerald-500":"bg-stone-200")})]},e.num))})}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-6",children:[1===w&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)(c.Z,{className:"w-12 h-12 text-stone-300 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-stone-900",children:"Select Period to Close"}),(0,a.jsx)("p",{className:"text-[14px] text-stone-500 mt-1",children:"Choose the month and year you want to close"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 max-w-sm mx-auto",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-[13px] font-medium text-stone-700 mb-2",children:"Month"}),(0,a.jsx)("select",{value:T,onChange:e=>S(parseInt(e.target.value)),className:"w-full px-4 py-3 border border-stone-200 rounded-xl text-[14px] focus:outline-none focus:ring-2 focus:ring-stone-200",children:I.map((e,t)=>(0,a.jsx)("option",{value:t,children:e},t))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-[13px] font-medium text-stone-700 mb-2",children:"Year"}),(0,a.jsx)("select",{value:_,onChange:e=>k(parseInt(e.target.value)),className:"w-full px-4 py-3 border border-stone-200 rounded-xl text-[14px] focus:outline-none focus:ring-2 focus:ring-stone-200",children:J.map(e=>(0,a.jsx)("option",{value:e,children:e},e))})]})]}),(0,a.jsx)("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-4 mt-6",children:(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)(f.Z,{className:"w-5 h-5 text-amber-600 flex-shrink-0"}),(0,a.jsxs)("div",{className:"text-[13px] text-amber-800",children:[(0,a.jsx)("p",{className:"font-medium",children:"This action is permanent"}),(0,a.jsx)("p",{className:"mt-1",children:"Once a period is closed, transactions within that period cannot be modified. You'll need to create correcting entries in open periods to make adjustments."})]})]})})]}),2===w&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"text-center mb-6",children:[(0,a.jsx)(N.Z,{className:"w-12 h-12 text-stone-300 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-stone-900",children:"Preflight Checks"}),(0,a.jsxs)("p",{className:"text-[14px] text-stone-500 mt-1",children:["Verifying ",I[T]," ",_," is ready to close"]})]}),(0,a.jsx)("div",{className:"space-y-3",children:R.map(e=>(0,a.jsx)("div",{className:"p-4 rounded-xl border transition-colors ".concat("passed"===e.status?"bg-emerald-50 border-emerald-200":"failed"===e.status?"bg-red-50 border-red-200":"warning"===e.status?"bg-amber-50 border-amber-200":"bg-white border-stone-200"),children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:["checking"===e.status?(0,a.jsx)(m.Z,{className:"w-5 h-5 text-stone-400 animate-spin"}):"passed"===e.status?(0,a.jsx)(v.Z,{className:"w-5 h-5 text-emerald-600"}):"failed"===e.status?(0,a.jsx)(j.Z,{className:"w-5 h-5 text-red-600"}):"warning"===e.status?(0,a.jsx)(f.Z,{className:"w-5 h-5 text-amber-600"}):(0,a.jsx)("div",{className:"w-5 h-5 rounded-full border-2 border-stone-300"}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-[14px] font-medium text-stone-900",children:[e.name,e.required&&(0,a.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),(0,a.jsx)("p",{className:"text-[12px] text-stone-500",children:e.description})]})]}),e.details&&(0,a.jsx)("span",{className:"text-[12px] font-medium ".concat("passed"===e.status?"text-emerald-600":"failed"===e.status?"text-red-600":"warning"===e.status?"text-amber-600":"text-stone-500"),children:e.details})]})},e.id))}),!H&&R.some(e=>"failed"===e.status)&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 mt-4",children:(0,a.jsx)("p",{className:"text-[13px] text-red-800",children:"Required checks must pass before closing the period. Please resolve the issues above."})})]}),3===w&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"text-center mb-6",children:[(0,a.jsx)(i.Z,{className:"w-12 h-12 text-stone-300 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-stone-900",children:"Review Trial Balance"}),(0,a.jsx)("p",{className:"text-[14px] text-stone-500 mt-1",children:"This snapshot will be frozen when the period closes"})]}),P?(0,a.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,a.jsx)(m.Z,{className:"w-8 h-8 text-stone-400 animate-spin"})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"bg-white border border-stone-200 rounded-xl overflow-hidden",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"bg-stone-50 border-b border-stone-200",children:[(0,a.jsx)("th",{className:"text-left text-[11px] font-medium text-stone-500 uppercase tracking-wider px-4 py-3",children:"Account"}),(0,a.jsx)("th",{className:"text-left text-[11px] font-medium text-stone-500 uppercase tracking-wider px-4 py-3",children:"Type"}),(0,a.jsx)("th",{className:"text-right text-[11px] font-medium text-stone-500 uppercase tracking-wider px-4 py-3",children:"Debit"}),(0,a.jsx)("th",{className:"text-right text-[11px] font-medium text-stone-500 uppercase tracking-wider px-4 py-3",children:"Credit"})]})}),(0,a.jsx)("tbody",{children:L.slice(0,10).map((e,t)=>(0,a.jsxs)("tr",{className:"border-b border-stone-50",children:[(0,a.jsx)("td",{className:"px-4 py-3 text-[13px] text-stone-900",children:e.account}),(0,a.jsx)("td",{className:"px-4 py-3 text-[12px] text-stone-500",children:e.type}),(0,a.jsx)("td",{className:"px-4 py-3 text-[13px] text-right text-stone-900",children:e.debit>0?G(e.debit):"—"}),(0,a.jsx)("td",{className:"px-4 py-3 text-[13px] text-right text-stone-900",children:e.credit>0?G(e.credit):"—"})]},t))}),(0,a.jsx)("tfoot",{children:(0,a.jsxs)("tr",{className:"bg-stone-50 font-medium",children:[(0,a.jsx)("td",{colSpan:2,className:"px-4 py-3 text-[13px] text-stone-900",children:"Totals"}),(0,a.jsx)("td",{className:"px-4 py-3 text-[13px] text-right text-stone-900",children:G(A.debits)}),(0,a.jsx)("td",{className:"px-4 py-3 text-[13px] text-right text-stone-900",children:G(A.credits)})]})})]})}),(0,a.jsx)("div",{className:"p-4 rounded-xl border ".concat(A.balanced?"bg-emerald-50 border-emerald-200":"bg-red-50 border-red-200"),children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[A.balanced?(0,a.jsx)(v.Z,{className:"w-5 h-5 text-emerald-600"}):(0,a.jsx)(f.Z,{className:"w-5 h-5 text-red-600"}),(0,a.jsx)("span",{className:"text-[14px] font-medium ".concat(A.balanced?"text-emerald-800":"text-red-800"),children:A.balanced?"Ledger is balanced and ready to close":"Ledger is out of balance by ".concat(G(Math.abs(A.debits-A.credits)))})]})})]})]}),4===w&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"text-center mb-6",children:[(0,a.jsx)(o.Z,{className:"w-12 h-12 text-stone-300 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-stone-900",children:"Confirm Period Close"}),(0,a.jsxs)("p",{className:"text-[14px] text-stone-500 mt-1",children:["You're about to lock ",I[T]," ",_]})]}),(0,a.jsxs)("div",{className:"bg-stone-50 rounded-xl p-5 space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between text-[14px]",children:[(0,a.jsx)("span",{className:"text-stone-500",children:"Period"}),(0,a.jsxs)("span",{className:"font-medium text-stone-900",children:[I[T]," ",_]})]}),(0,a.jsxs)("div",{className:"flex justify-between text-[14px]",children:[(0,a.jsx)("span",{className:"text-stone-500",children:"Total Debits"}),(0,a.jsx)("span",{className:"font-medium text-stone-900",children:G(A.debits)})]}),(0,a.jsxs)("div",{className:"flex justify-between text-[14px]",children:[(0,a.jsx)("span",{className:"text-stone-500",children:"Total Credits"}),(0,a.jsx)("span",{className:"font-medium text-stone-900",children:G(A.credits)})]}),(0,a.jsxs)("div",{className:"flex justify-between text-[14px] pt-3 border-t",children:[(0,a.jsx)("span",{className:"text-stone-500",children:"Balance Status"}),(0,a.jsx)("span",{className:"font-medium text-emerald-600",children:"Balanced ✓"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-[13px] font-medium text-stone-700 mb-2",children:"Closing Notes (optional)"}),(0,a.jsx)("textarea",{value:U,onChange:e=>Y(e.target.value),placeholder:"Add any notes about this period close...",rows:3,className:"w-full px-4 py-3 border border-stone-200 rounded-xl text-[14px] placeholder:text-stone-400 focus:outline-none focus:ring-2 focus:ring-stone-200 resize-none"})]}),(0,a.jsx)("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-4",children:(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)(f.Z,{className:"w-5 h-5 text-amber-600 flex-shrink-0"}),(0,a.jsxs)("div",{className:"text-[13px] text-amber-800",children:[(0,a.jsx)("p",{className:"font-medium",children:"Final warning"}),(0,a.jsx)("p",{className:"mt-1",children:"This will generate frozen financial statements with integrity hashes. All transactions in this period will become read-only."})]})]})})]}),5===w&&q&&(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"w-16 h-16 rounded-full bg-emerald-100 flex items-center justify-center mx-auto mb-6",children:(0,a.jsx)(v.Z,{className:"w-8 h-8 text-emerald-600"})}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-stone-900 mb-2",children:"Period Closed Successfully"}),(0,a.jsxs)("p",{className:"text-[14px] text-stone-500 mb-8",children:[I[T]," ",_," is now locked"]}),(0,a.jsxs)("div",{className:"bg-stone-50 rounded-xl p-5 text-left space-y-3 mb-6",children:[(0,a.jsxs)("div",{className:"flex justify-between text-[14px]",children:[(0,a.jsx)("span",{className:"text-stone-500",children:"Period ID"}),(0,a.jsxs)("span",{className:"font-mono text-[12px] text-stone-600",children:[null===(t=q.period_id)||void 0===t?void 0:t.slice(0,8),"..."]})]}),(0,a.jsxs)("div",{className:"flex justify-between text-[14px]",children:[(0,a.jsx)("span",{className:"text-stone-500",children:"Integrity Hash"}),(0,a.jsxs)("span",{className:"font-mono text-[12px] text-stone-600",children:[null===(s=q.closing_hash)||void 0===s?void 0:s.slice(0,16),"..."]})]}),(0,a.jsxs)("div",{className:"flex justify-between text-[14px]",children:[(0,a.jsx)("span",{className:"text-stone-500",children:"Closed At"}),(0,a.jsx)("span",{className:"text-stone-900",children:new Date().toLocaleString()})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-center gap-3",children:[(0,a.jsxs)("button",{className:"flex items-center gap-2 px-4 py-2 bg-white border border-stone-200 rounded-lg text-[13px] font-medium hover:bg-stone-50",children:[(0,a.jsx)(p.Z,{className:"w-4 h-4"}),"Download Statements"]}),(0,a.jsxs)("button",{className:"flex items-center gap-2 px-4 py-2 bg-white border border-stone-200 rounded-lg text-[13px] font-medium hover:bg-stone-50",children:[(0,a.jsx)(g.Z,{className:"w-4 h-4"}),"View Frozen Reports"]})]})]})]}),(0,a.jsx)("div",{className:"px-6 py-4 border-t bg-stone-50 flex items-center justify-between",children:w<5?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("button",{onClick:()=>w>1?C(w-1):r(),className:"flex items-center gap-2 px-4 py-2 text-[14px] font-medium text-stone-600 hover:text-stone-900",children:[(0,a.jsx)(y.Z,{className:"w-4 h-4"}),1===w?"Cancel":"Back"]}),w<4?(0,a.jsxs)("button",{onClick:()=>C(w+1),disabled:2===w&&!H,className:"flex items-center gap-2 px-5 py-2 bg-stone-900 text-white rounded-lg text-[14px] font-medium hover:bg-stone-800 disabled:opacity-50 disabled:cursor-not-allowed",children:["Continue",(0,a.jsx)(x.Z,{className:"w-4 h-4"})]}):(0,a.jsxs)("button",{onClick:W,disabled:Z,className:"flex items-center gap-2 px-5 py-2 bg-red-600 text-white rounded-lg text-[14px] font-medium hover:bg-red-700 disabled:opacity-50",children:[Z&&(0,a.jsx)(m.Z,{className:"w-4 h-4 animate-spin"}),(0,a.jsx)(o.Z,{className:"w-4 h-4"}),"Close Period"]})]}):(0,a.jsx)("button",{onClick:()=>{d(),r()},className:"ml-auto px-5 py-2 bg-stone-900 text-white rounded-lg text-[14px] font-medium hover:bg-stone-800",children:"Done"})})]})]}):null}function C(){var e,t,s,h,j,b,f,N,v,g,y,C,_,k,T,S,P,F;let{mode:Z}=(0,u.c5)(),[D,R]=(0,n.useState)(null),[O,L]=(0,n.useState)({start:"2025-01-01",end:"2025-12-31"}),[$,A]=(0,n.useState)(!1),[E,q]=(0,n.useState)(null),[B,U]=(0,n.useState)(null),[Y,I]=(0,n.useState)(!1),M=[{id:"profit_loss",name:"Profit & Loss",description:"Income statement for the period",icon:l.Z,color:"emerald",pdfType:"profit_loss"},{id:"trial_balance",name:"Trial Balance",description:"All account balances",icon:i.Z,color:"blue",pdfType:"trial_balance"},{id:"creator_earnings",name:"marketplace"===Z?"Creator Earnings":"Contractor Payments",description:"Payments by payee",icon:r.Z,color:"violet",pdfType:null},{id:"1099_summary",name:"1099 Summary",description:"Tax year payments over $600",icon:d.Z,color:"amber",pdfType:"1099"}],J=async e=>{A(!0),R(e);try{let t=await fetch("/api/reports",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({report_type:e,start_date:O.start,end_date:O.end})}),s=await t.json();U(s.report||s)}catch(e){console.error("Failed to fetch report:",e)}A(!1)},z=async e=>{q(e);try{let t=await fetch("/api/pdf",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({report_type:e,start_date:O.start,end_date:O.end,tax_year:new Date(O.end).getFullYear()})}),s=await t.json();if(s.success&&s.data){let t=atob(s.data),a=Array(t.length);for(let e=0;e<t.length;e++)a[e]=t.charCodeAt(e);let n=new Uint8Array(a),l=new Blob([n],{type:"application/pdf"}),i=window.URL.createObjectURL(l),r=document.createElement("a");r.href=i,r.download=s.filename||"report_".concat(e,".pdf"),document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(i),document.body.removeChild(r)}else alert(s.error||"Failed to generate PDF")}catch(e){console.error("Failed to download PDF:",e),alert("Failed to download PDF")}q(null)},V=M.find(e=>e.id===D);return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold text-[#1C1917]",children:"Reports"}),(0,a.jsx)("p",{className:"text-[14px] text-stone-500 mt-1",children:"Financial reports and exports"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 bg-white border rounded-lg px-3 py-2",children:[(0,a.jsx)(c.Z,{className:"w-4 h-4 text-stone-400"}),(0,a.jsx)("input",{type:"date",value:O.start,onChange:e=>L(t=>({...t,start:e.target.value})),className:"text-[13px] border-none focus:outline-none"}),(0,a.jsx)("span",{className:"text-stone-300",children:"→"}),(0,a.jsx)("input",{type:"date",value:O.end,onChange:e=>L(t=>({...t,end:e.target.value})),className:"text-[13px] border-none focus:outline-none"})]}),(0,a.jsxs)("button",{onClick:()=>I(!0),className:"flex items-center gap-2 px-4 py-2 bg-[#1C1917] text-white rounded-lg text-[13px] font-medium hover:bg-[#292524]",children:[(0,a.jsx)(o.Z,{className:"w-4 h-4"}),"Close Month"]})]})]}),(0,a.jsx)("div",{className:"bg-gradient-to-r from-stone-900 to-stone-800 rounded-xl p-5 text-white",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-stone-400 text-[12px] font-medium uppercase tracking-wider mb-1",children:"Current Period"}),(0,a.jsx)("p",{className:"text-xl font-semibold",children:"December 2024"}),(0,a.jsx)("p",{className:"text-stone-400 text-[13px] mt-1",children:"Open for transactions"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-6",children:[(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"text-stone-400 text-[12px]",children:"Last Closed"}),(0,a.jsx)("p",{className:"text-[14px] font-medium",children:"November 2024"})]}),(0,a.jsx)("div",{className:"h-10 w-px bg-stone-700"}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"text-stone-400 text-[12px]",children:"Fiscal Year"}),(0,a.jsx)("p",{className:"text-[14px] font-medium",children:"2024"})]}),(0,a.jsxs)("button",{onClick:()=>I(!0),className:"flex items-center gap-2 px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg text-[13px] font-medium transition-colors",children:["Close Period",(0,a.jsx)(x.Z,{className:"w-4 h-4"})]})]})]})}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:M.map(e=>{let t=e.icon,s=D===e.id;return(0,a.jsxs)("button",{onClick:()=>J(e.id),className:"text-left p-5 rounded-xl border transition-all ".concat(s?"border-stone-900 bg-stone-50":"bg-white hover:border-stone-300"),children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center mb-3 ".concat("emerald"===e.color?"bg-emerald-100 text-emerald-600":"blue"===e.color?"bg-blue-100 text-blue-600":"violet"===e.color?"bg-violet-100 text-violet-600":"bg-amber-100 text-amber-600"),children:(0,a.jsx)(t,{className:"w-5 h-5"})}),(0,a.jsx)("div",{className:"font-medium text-[14px]",children:e.name}),(0,a.jsx)("div",{className:"text-[12px] text-stone-500 mt-1",children:e.description})]},e.id)})}),$&&(0,a.jsxs)("div",{className:"bg-white rounded-xl border p-12 text-center",children:[(0,a.jsx)("div",{className:"animate-spin w-8 h-8 border-2 border-stone-300 border-t-stone-900 rounded-full mx-auto"}),(0,a.jsx)("p",{className:"text-[14px] text-stone-500 mt-4",children:"Generating report..."})]}),!$&&B&&(0,a.jsxs)("div",{className:"bg-white rounded-xl border",children:[(0,a.jsxs)("div",{className:"px-5 py-4 border-b flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"font-semibold",children:null==V?void 0:V.name}),(0,a.jsxs)("p",{className:"text-[12px] text-stone-500",children:[null===(e=B.period)||void 0===e?void 0:e.start," to ",(null===(t=B.period)||void 0===t?void 0:t.end)||B.as_of||B.tax_year]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(null==V?void 0:V.pdfType)&&(0,a.jsxs)("button",{onClick:()=>z(V.pdfType),disabled:!!E,className:"flex items-center gap-2 px-3 py-2 bg-red-50 hover:bg-red-100 text-red-700 rounded-lg text-[13px] font-medium disabled:opacity-50",children:[E===V.pdfType?(0,a.jsx)(m.Z,{className:"w-4 h-4 animate-spin"}):(0,a.jsx)(d.Z,{className:"w-4 h-4"}),"PDF"]}),(0,a.jsxs)("button",{onClick:()=>{if(!B||!D)return;let e="";if("profit_loss"===D&&B.revenue){for(let t of(e="Category,Account,Amount\n",B.revenue.items||[]))e+="Revenue,".concat(t.name,",").concat(t.amount,"\n");for(let t of(e+="Revenue,Total,".concat(B.revenue.total,"\n"),B.expenses.items||[]))e+="Expense,".concat(t.name,",").concat(t.amount,"\n");e+="Expense,Total,".concat(B.expenses.total,"\n")+"Net Income,,".concat(B.net_income,"\n")}else if("trial_balance"===D&&B.accounts){var t,s;for(let t of(e="Account,Type,Debit,Credit\n",B.accounts))e+="".concat(t.account,",").concat(t.account_type,",").concat(t.debit,",").concat(t.credit,"\n");e+="Totals,,".concat(null===(t=B.totals)||void 0===t?void 0:t.debits,",").concat(null===(s=B.totals)||void 0===s?void 0:s.credits,"\n")}else if("creator_earnings"===D&&B.creators)for(let t of(e="Name,Tier,Earned,Paid,Balance\n",B.creators))e+="".concat(t.name,",").concat(t.tier,",").concat(t.total_earned,",").concat(t.total_paid,",").concat(t.balance,"\n");else if("1099_summary"===D&&B.payees)for(let t of(e="Payee,Total Paid,1099 Required,W-9 Status\n",B.payees))e+="".concat(t.name,",").concat(t.total_paid,",").concat(t.requires_1099?"Yes":"No",",").concat(t.w9_status,"\n");let a=new Blob([e],{type:"text/csv"}),n=window.URL.createObjectURL(a),l=document.createElement("a");l.href=n,l.download="".concat(D,"_").concat(O.start,"_").concat(O.end,".csv"),document.body.appendChild(l),l.click(),window.URL.revokeObjectURL(n),document.body.removeChild(l)},className:"flex items-center gap-2 px-3 py-2 bg-stone-100 hover:bg-stone-200 rounded-lg text-[13px] font-medium",children:[(0,a.jsx)(p.Z,{className:"w-4 h-4"})," CSV"]})]})]}),"profit_loss"===D&&B.revenue&&(0,a.jsxs)("div",{className:"p-5 space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-[12px] font-medium text-stone-500 uppercase mb-3",children:"Revenue"}),null===(s=B.revenue.items)||void 0===s?void 0:s.map((e,t)=>{var s;return(0,a.jsxs)("div",{className:"flex justify-between py-2 text-[14px]",children:[(0,a.jsx)("span",{children:e.name}),(0,a.jsxs)("span",{className:"font-medium",children:["$",null===(s=e.amount)||void 0===s?void 0:s.toFixed(2)]})]},t)}),(0,a.jsxs)("div",{className:"flex justify-between py-2 text-[14px] font-semibold border-t mt-2 pt-2",children:[(0,a.jsx)("span",{children:"Total Revenue"}),(0,a.jsxs)("span",{className:"text-emerald-600",children:["$",null===(h=B.revenue.total)||void 0===h?void 0:h.toFixed(2)]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-[12px] font-medium text-stone-500 uppercase mb-3",children:"Expenses"}),null===(j=B.expenses.items)||void 0===j?void 0:j.map((e,t)=>{var s;return(0,a.jsxs)("div",{className:"flex justify-between py-2 text-[14px]",children:[(0,a.jsx)("span",{children:e.name}),(0,a.jsxs)("span",{className:"font-medium",children:["$",null===(s=e.amount)||void 0===s?void 0:s.toFixed(2)]})]},t)}),(0,a.jsxs)("div",{className:"flex justify-between py-2 text-[14px] font-semibold border-t mt-2 pt-2",children:[(0,a.jsx)("span",{children:"Total Expenses"}),(0,a.jsxs)("span",{className:"text-red-500",children:["$",null===(b=B.expenses.total)||void 0===b?void 0:b.toFixed(2)]})]})]}),(0,a.jsxs)("div",{className:"flex justify-between py-4 text-lg font-bold border-t-2",children:[(0,a.jsx)("span",{children:"Net Income"}),(0,a.jsxs)("span",{className:B.net_income>=0?"text-emerald-600":"text-red-500",children:["$",null===(f=B.net_income)||void 0===f?void 0:f.toFixed(2)]})]})]}),"trial_balance"===D&&B.accounts&&(0,a.jsxs)("div",{className:"p-5",children:[(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"text-[12px] text-stone-500 uppercase",children:[(0,a.jsx)("th",{className:"text-left py-2",children:"Account"}),(0,a.jsx)("th",{className:"text-left py-2",children:"Type"}),(0,a.jsx)("th",{className:"text-right py-2",children:"Debit"}),(0,a.jsx)("th",{className:"text-right py-2",children:"Credit"})]})}),(0,a.jsx)("tbody",{children:B.accounts.map((e,t)=>(0,a.jsxs)("tr",{className:"border-t text-[14px]",children:[(0,a.jsx)("td",{className:"py-3",children:e.account}),(0,a.jsx)("td",{className:"py-3 text-stone-500",children:e.account_type}),(0,a.jsx)("td",{className:"py-3 text-right",children:e.debit>0?"$".concat(e.debit.toFixed(2)):"—"}),(0,a.jsx)("td",{className:"py-3 text-right",children:e.credit>0?"$".concat(e.credit.toFixed(2)):"—"})]},t))}),(0,a.jsx)("tfoot",{children:(0,a.jsxs)("tr",{className:"border-t-2 font-semibold text-[14px]",children:[(0,a.jsx)("td",{className:"py-3",colSpan:2,children:"Totals"}),(0,a.jsxs)("td",{className:"py-3 text-right",children:["$",null===(v=B.totals)||void 0===v?void 0:null===(N=v.debits)||void 0===N?void 0:N.toFixed(2)]}),(0,a.jsxs)("td",{className:"py-3 text-right",children:["$",null===(y=B.totals)||void 0===y?void 0:null===(g=y.credits)||void 0===g?void 0:g.toFixed(2)]})]})})]}),(0,a.jsx)("div",{className:"mt-4 px-4 py-3 rounded-lg text-[13px] ".concat((null===(C=B.totals)||void 0===C?void 0:C.balanced)?"bg-emerald-50 text-emerald-700":"bg-red-50 text-red-700"),children:(null===(_=B.totals)||void 0===_?void 0:_.balanced)?"✓ Ledger is balanced":"⚠ Ledger is out of balance"})]}),"creator_earnings"===D&&B.creators&&(0,a.jsx)("div",{className:"p-5",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"text-[12px] text-stone-500 uppercase",children:[(0,a.jsx)("th",{className:"text-left py-2",children:"Name"}),(0,a.jsx)("th",{className:"text-left py-2",children:"Tier"}),(0,a.jsx)("th",{className:"text-right py-2",children:"Earned"}),(0,a.jsx)("th",{className:"text-right py-2",children:"Paid"}),(0,a.jsx)("th",{className:"text-right py-2",children:"Balance"})]})}),(0,a.jsx)("tbody",{children:B.creators.map((e,t)=>{var s,n,l;return(0,a.jsxs)("tr",{className:"border-t text-[14px]",children:[(0,a.jsx)("td",{className:"py-3 font-medium",children:e.name}),(0,a.jsx)("td",{className:"py-3",children:(0,a.jsx)("span",{className:"px-2 py-1 bg-stone-100 rounded text-[12px]",children:e.tier})}),(0,a.jsxs)("td",{className:"py-3 text-right text-emerald-600",children:["$",null===(s=e.total_earned)||void 0===s?void 0:s.toFixed(2)]}),(0,a.jsxs)("td",{className:"py-3 text-right",children:["$",null===(n=e.total_paid)||void 0===n?void 0:n.toFixed(2)]}),(0,a.jsxs)("td",{className:"py-3 text-right font-medium",children:["$",null===(l=e.balance)||void 0===l?void 0:l.toFixed(2)]})]},t)})}),(0,a.jsx)("tfoot",{children:(0,a.jsxs)("tr",{className:"border-t-2 font-semibold text-[14px]",children:[(0,a.jsx)("td",{className:"py-3",colSpan:2,children:"Totals"}),(0,a.jsxs)("td",{className:"py-3 text-right text-emerald-600",children:["$",null===(T=B.totals)||void 0===T?void 0:null===(k=T.earned)||void 0===k?void 0:k.toFixed(2)]}),(0,a.jsxs)("td",{className:"py-3 text-right",children:["$",null===(P=B.totals)||void 0===P?void 0:null===(S=P.paid)||void 0===S?void 0:S.toFixed(2)]}),(0,a.jsx)("td",{className:"py-3 text-right"})]})})]})}),"1099_summary"===D&&B.payees&&(0,a.jsxs)("div",{className:"p-5",children:[(0,a.jsxs)("div",{className:"mb-4 px-4 py-3 bg-amber-50 rounded-lg text-[13px] text-amber-800",children:["Tax Year ",B.tax_year,": ",null===(F=B.summary)||void 0===F?void 0:F.requiring_1099," payees require 1099 forms (paid ≥ $600)"]}),(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"text-[12px] text-stone-500 uppercase",children:[(0,a.jsx)("th",{className:"text-left py-2",children:"Payee"}),(0,a.jsx)("th",{className:"text-right py-2",children:"Total Paid"}),(0,a.jsx)("th",{className:"text-center py-2",children:"1099 Required"}),(0,a.jsx)("th",{className:"text-center py-2",children:"W-9 Status"})]})}),(0,a.jsx)("tbody",{children:B.payees.map((e,t)=>{var s;return(0,a.jsxs)("tr",{className:"border-t text-[14px]",children:[(0,a.jsx)("td",{className:"py-3 font-medium",children:e.name}),(0,a.jsxs)("td",{className:"py-3 text-right",children:["$",null===(s=e.total_paid)||void 0===s?void 0:s.toFixed(2)]}),(0,a.jsx)("td",{className:"py-3 text-center",children:e.requires_1099?(0,a.jsx)("span",{className:"text-amber-600 font-medium",children:"Yes"}):(0,a.jsx)("span",{className:"text-stone-400",children:"No"})}),(0,a.jsx)("td",{className:"py-3 text-center",children:(0,a.jsx)("span",{className:"px-2 py-1 rounded text-[12px] ".concat("verified"===e.w9_status?"bg-emerald-100 text-emerald-700":"bg-stone-100 text-stone-500"),children:e.w9_status||"Unknown"})})]},t)})})]})]})]}),!$&&!B&&(0,a.jsxs)("div",{className:"bg-white rounded-xl border p-12 text-center",children:[(0,a.jsx)(d.Z,{className:"w-12 h-12 text-stone-300 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-[14px] text-stone-500",children:"Select a report to generate"})]}),(0,a.jsx)(w,{open:Y,onClose:()=>I(!1),onComplete:()=>{I(!1)}})]})}function _(){return(0,a.jsx)(u.dM,{mode:"marketplace",ledgerId:"0a885204-e07a-48c1-97e9-495ac96a2581",businessName:"Booklyverse",children:(0,a.jsx)(h.c,{children:(0,a.jsx)(C,{})})})}}},function(e){e.O(0,[2972,8557,9864,2971,2117,1744],function(){return e(e.s=734)}),_N_E=e.O()}]);